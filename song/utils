from pathlib import Path

from youtube_dl import YoutubeDL

from models2 import Song
from paths import songs_dir


def download_song(url) -> Song:
    download_options = {
        'format': 'bestaudio/best',
        'outtmpl': f'{songs_dir}/%(title)s.%(ext)s',
        'nocheckcertificate': True,
        'postprocessors': [{
            'key': 'FFmpegExtractAudio',
            'preferredcodec': 'mp3',
            'preferredquality': '192',
        }]
    }

    with YoutubeDL(download_options) as youtube:
        youtube.download([url])
        info = youtube.extract_info(url)
        song = Song(
            video_id=info.get('id'),
            title=info.get('title'),
            path=Path(youtube.filename),
            description=info.get('description'),
            # credit=get_credit(info.get('description')),

        )
    return song
